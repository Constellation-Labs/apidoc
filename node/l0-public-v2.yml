openapi: 3.0.3
info:
  title: L0 Node - Public API
  description: ''
  contact:
    email: operators@constellationnetwork.io
  version: 2.0.0

tags:
  - name: Cluster
  - name: Global snapshot
  - name: DAG
  - name: State channel
  - name: Metric

paths:
  /cluster/info:
    get:
      tags:
        - Cluster
      description: Get Cluster info
      responses:
        200:
          description: Cluster info
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Peer'

  /dag/total-supply:
    get:
      tags:
        - DAG
      description: Get $DAG total supply on latest snapshot
      responses:
        200:
          description: Total supply on latest snapshot
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TotalSupply'

  /dag/{ordinal}/total-supply:
    get:
      tags:
        - DAG
      description: Get $DAG total supply on given snapshot
      parameters:
        - name: ordinal
          in: path
          description: Snapshot ordinal
          required: true
          schema:
            $ref: '#/components/schemas/SnapshotOrdinal'
      responses:
        200:
          description: Total supply on given snapshot
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TotalSupply'

  /dag/{address}/balance:
    get:
      tags:
        - DAG
      description: Get $DAG balance for given address
      parameters:
        - name: address
          in: path
          description: DAG Address
          required: true
          schema:
            $ref: '#/components/schemas/Address'
      responses:
        200:
          description: $DAG balance for given address
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Balance'

  /dag/{ordinal}/{address}/balance:
    get:
      tags:
        - DAG
      description: Get $DAG balance for given address on given snapshot
      parameters:
        - name: ordinal
          in: path
          description: Snapshot ordinal
          required: true
          schema:
            $ref: '#/components/schemas/SnapshotOrdinal'
        - name: address
          in: path
          description: DAG Address
          required: true
          schema:
            $ref: '#/components/schemas/Address'
      responses:
        200:
          description: $DAG balance for given address on given snapshot
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Balance'

  /global-snapshot/latest/ordinal:
    get:
      tags:
        - Global snapshot
      description: Get latest global snapshot ordinal
      responses:
        200:
          description: Latest global snapshot ordinal
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    $ref: '#/components/schemas/SnapshotOrdinal'
        404:
          description: State channel not found
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'

  /global-snapshot/latest:
    get:
      tags:
        - Global snapshot
      description: Get latest global snapshot
      responses:
        200:
          description: Latest global snapshot
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        404:
          description: State channel not found
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'

  /global-snapshot/{ordinal}:
    get:
      tags:
        - Global snapshot
      description: Get global snapshot by given ordinal
      parameters:
        - name: ordinal
          in: path
          description: Snapshot ordinal
          required: true
          schema:
            $ref: '#/components/schemas/SnapshotOrdinal'
      responses:
        200:
          description: Global snapshot for given ordinal
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        404:
          description: Global snapshot not found
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'

  /state-channel/{address}/input:
    post:
      tags:
        - State channel
      description: Post input to given state channel
      parameters:
        - name: address
          in: path
          description: State channel address
          required: true
          schema:
            $ref: '#/components/schemas/Address'
      requestBody:
        description: State channel input
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: Ok
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
        404:
          description: State channel not found
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'

  /metric:
    get:
      tags:
        - Metric
      description: Micrometer metrics
      responses:
        200:
          description: Micrometer metrics
          headers:
            X-Id:
              $ref: '#/components/headers/X-Id'
            X-Session-Token:
              $ref: '#/components/headers/X-Session-Token'
            Request-Signature:
              $ref: '#/components/headers/Request-Signature'
          content:
            text/html:
              schema:
                type: string

components:
  headers:
    X-Id:
      description: Node Id
      schema:
        $ref: '#/components/schemas/PeerId'
    X-Session-Token:
      description: Session identifier
      schema:
        $ref: '#/components/schemas/SessionToken'
    Request-Signature:
      description: RSA signature of the response
      schema:
        type: string
        example: 'MEQCIE35YM9i8xekL7P9M9Nx3858d9rlY+k2xCIRhgVM/O0nAiBlC4x+GqJ07LVhT5svcn5UWJGOXbch2ampvNkCE2nVOQ=='
  schemas:
    PeerId:
      type: string
      example: 'c7f9a08bdea7ff5f51c8af16e223a1d751bac9c541125d9aef5658e9b7597aee8cba374119ebe83fb9edd8c0b4654af273f2d052e2d7dd5c6160b6d6c284a17c'
    Host:
      description: 'IP address'
      type: string
      example: '1.2.3.4'
    Port:
      description: 'Port 0-65535'
      type: integer
      example: 1234
    SessionToken:
      description: 'Session UUID token'
      type: string
      example: 'c87315e1-5ac5-49ce-baa6-e0b1d7aeeb4e'
    NodeState:
      description: 'Node state'
      type: string
      enum:
        - 'Ready'
        - 'Initial'
        - 'ReadyToJoin'
        - 'LoadingGenesis'
        - 'GenesisReady'
        - 'StartingSession'
        - 'SessionStarted'
        - 'WaitingForDownload'
        - 'DownloadInProgress'
        - 'Leaving'
        - 'Offline'
    Peer:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/PeerId'
        ip:
          $ref: '#/components/schemas/Host'
        publicPort:
          $ref: '#/components/schemas/Port'
        p2pPort:
          $ref: '#/components/schemas/Port'
        session:
          $ref: '#/components/schemas/SessionToken'
        state:
          $ref: '#/components/schemas/NodeState'
    SnapshotOrdinal:
      type: integer
      example: 156
    Address:
      type: string
      example: 'DAG4xPWQj3BpAg2YKg3kbdW2AJcMfZz2SUKqYb1t'
    TotalSupply:
      type: object
      properties:
        total:
          type: integer
          example: 12345678
        ordinal:
          $ref: '#/components/schemas/SnapshotOrdinal'
    Balance:
      type: object
      properties:
        balance:
          type: integer
          example: 1234
        ordinal:
          $ref: '#/components/schemas/SnapshotOrdinal'
